name: Rclone Dedupe

on:
  workflow_dispatch:
  
  schedule:
    - cron: 0 */12 * * *

jobs:
  bolan:
    runs-on: ubuntu-latest
    steps:
      - name: rclone dedupe
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "dedupe bolan: --dedupe-mode largest -v "
      - name: rclone cleanup
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "cleanup bolan: "
      - name: rclone rmdirs
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "rmdirs bolan: -v "

    wuxian:
      runs-on: ubuntu-latest
      steps:
      - name: rclone dedupe
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "dedupe wuxian:Storage --dedupe-mode largest -v "
      - name: rclone cleanup
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "cleanup wuxian: "
      - name: rclone rmdirs
        uses: wei/rclone@v1
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
        with:
          args: "rmdirs wuxian:Storage -v "
